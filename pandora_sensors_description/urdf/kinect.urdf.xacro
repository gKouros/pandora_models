<?xml version="1.0" ?>

<robot xmlns:xacro="http://ros.org/wiki/xacro" >

<!-- ###################################################################### -->

  <xacro:macro name="kinect_caster"
               params="parent
                       fixed
                       pitch_min_limit
                       pitch_max_limit
                       yaw_min_limit
                       yaw_max_limit
                       *origin" >

    <!-- ################################################################## -->

    <link name="kinect_servo_link" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.00754 0.0 0.00124" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

      <visual>
        <!-- ============================================================== -->
        <origin xyz="-0.01593 0.0 0.0"
                rpy="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <geometry>
          <mesh filename="package://pandora_robots_description/meshes/gears/visual/linear/head/servo_motor.dae" />
        </geometry>
        <!-- ============================================================== -->
      </visual>

      <collision>
        <!-- ============================================================== -->
        <origin xyz="0.00754 0.0 0.00124"
                rpy="0 0 0" />
        <!-- ============================================================== -->
        <geometry>
          <box size="0.050 0.032 0.041" />
        </geometry>
        <!-- ============================================================== -->
      </collision>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_base_link" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.03416 0.0 0.01146" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

      <visual>
        <!-- ============================================================== -->
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <!-- ============================================================== -->
        <geometry>
          <mesh filename="package://pandora_sensors_description/meshes/kinect/base.dae" />
        </geometry>
        <!-- ============================================================== -->
      </visual>

      <collision>
        <!-- ============================================================== -->
        <origin xyz="0.02131 0.0 0.01992"
                rpy="0 0 0" />
        <!-- ============================================================== -->
        <geometry>
          <box size="0.07 0.055 0.04" />
        </geometry>
        <!-- ============================================================== -->
      </collision>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_main_link" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.00052 0.00048 0.02055" />
        <!-- ============================================================== -->
        <mass value="0.226796185" />
        <!-- ============================================================== -->
        <inertia ixx="1.4641E-3"
                 ixy="0.0"
                 ixz="0.0"
                 iyy="9.2532E-5"
                 iyz="0.0"
                 izz="1.5077E-3" />
        <!-- ============================================================== -->
      </inertial>

      <visual>
        <!-- ============================================================== -->
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <!-- ============================================================== -->
        <geometry>
          <mesh filename="package://pandora_sensors_description/meshes/kinect/asus_xtion_pro.dae" />
        </geometry>
        <!-- ============================================================== -->
      </visual>

      <collision>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.01342"
                rpy="0 0 0" />
        <!-- ============================================================== -->
        <geometry>
          <box size="0.037 0.18 0.042" />
        </geometry>
        <!-- ============================================================== -->
      </collision>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_optical_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_depth_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_depth_optical_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_rgb_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>

    <!-- ################################################################## -->

    <link name="kinect_rgb_optical_frame" >

      <inertial>
        <!-- ============================================================== -->
        <origin xyz="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <mass value="0.0001" /><!--FIXME-->
        <!-- ============================================================== -->
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" /><!--FIXME-->
        <!-- ============================================================== -->
      </inertial>

    </link>
    
    <!-- Pitch Joint #######################################################-->

    <xacro:if value="${fixed}" >

      <joint name="kinect_pitch_joint"
             type="fixed" >

        <!-- ============================================================== -->
        <parent link="${parent}" />
        <child link="kinect_servo_link" />
        <!-- ============================================================== -->
        <xacro:insert_block name="origin" />
        <!-- ============================================================== -->

      </joint>
      
    </xacro:if>

    <xacro:unless value="${fixed}" >

      <joint name="kinect_pitch_joint"
             type="revolute" >

        <!-- ============================================================== -->
        <parent link="${parent}" />
        <child link="kinect_servo_link" />
        <!-- ============================================================== -->
        <xacro:insert_block name="origin" />
        <!-- ============================================================== -->
        <axis xyz="0 1 0" />
        <!-- ============================================================== -->
        <!-- <calibration rising="0.0"
                          falling="0.0" /> -->
        <!-- ============================================================== -->
        <!-- <dynamics damping="0.0"
                       friction="0.0" /> --> 
        <!-- ============================================================== -->
        <limit lower="${pitch_min_limit}"
               upper="${pitch_max_limit}"
               effort="50"
               velocity="50.0" />
        <!-- ============================================================== -->
        <!-- <safety_controller soft_lower_limit="0.0"
                                soft_upper_limit="0.0"
                                k_position="0.0"
                                k_velocity="0.0" /> -->
        <!-- ============================================================== -->

      </joint>
      
    </xacro:unless>
    
    <!-- Yaw Joint #########################################################-->

    <xacro:if value="${fixed}" >

      <joint name="kinect_yaw_joint"
             type="fixed" >

        <!-- ============================================================== -->
        <parent link="kinect_servo_link" />
        <child link="kinect_base_link" />
        <!-- ============================================================== -->
        <origin xyz="0.02107 0.0 0.021"
                rpy="0.0 0.0 0.0" />
        <!-- ============================================================== -->

      </joint>
      
    </xacro:if>

    <xacro:unless value="${fixed}" >

      <joint name="kinect_yaw_joint"
             type="revolute" >

        <!-- ============================================================== -->
        <parent link="kinect_servo_link" />
        <child link="kinect_base_link" />
        <!-- ============================================================== -->
        <origin xyz="0.02107 0.0 0.021"
                rpy="0.0 0.0 0.0" />
        <!-- ============================================================== -->
        <axis xyz="0 0 1" />
        <!-- ============================================================== -->
        <!-- <calibration rising="0.0"
                          falling="0.0" /> -->
        <!-- ============================================================== -->
        <!-- <dynamics damping="0.0"
                       friction="0.0" /> --> 
        <!-- ============================================================== -->
        <limit lower="${yaw_min_limit}"
               upper="${yaw_max_limit}"
               effort="50"
               velocity="50.0" />
        <!-- ============================================================== -->
        <!-- <safety_controller soft_lower_limit="0.0"
                                soft_upper_limit="0.0"
                                k_position="0.0"
                                k_velocity="0.0" /> -->
        <!-- ============================================================== -->

      </joint>
      
    </xacro:unless>
    
    <!-- Base Joint ########################################################-->

    <joint name="kinect_base_joint"
           type="fixed" >

      <!-- ================================================================ -->
      <parent link="kinect_base_link" />
      <child link="kinect_main_link" />
      <!-- ================================================================ -->
      <origin xyz="0.04274 0.0 0.03142"
              rpy="0.0 0.0 0.0" />
      <!-- ================================================================ -->

    </joint>
    
    <!-- Camera Joint ##################################################### -->
    
    <joint name="kinect_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_main_link" />
      <child link="kinect_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.01784 0.0 0.02167" 
              rpy="0.0 0.0 0.0" />
      <!-- ================================================================ -->
                 
    </joint>
    
    <joint name="kinect_optical_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_frame" />
      <child link="kinect_optical_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.0 0.0 0.0" 
              rpy="-1.5708 0.0 -1.5708" />
      <!-- ================================================================ -->
                 
    </joint>
    
    <!-- Depth Joint ###################################################### -->
    
    <joint name="kinect_depth_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_frame" />
      <child link="kinect_depth_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.0 0.044 0.0" 
              rpy="0.0 0.0 0.0" />
      <!-- ================================================================ -->
                 
    </joint>
    
    <joint name="kinect_depth_optical_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_depth_frame" />
      <child link="kinect_depth_optical_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.0 0.0 0.0" 
              rpy="-1.5708 0.0 -1.5708" />
      <!-- ================================================================ -->
                 
    </joint>
    
    <!-- RGB Joint ######################################################## -->
    
    <joint name="kinect_rgb_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_frame" />
      <child link="kinect_rgb_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.0 0.019 0.0" 
              rpy="0.0 0.0 0.0" />
      <!-- ================================================================ -->
                 
    </joint>
    
    <joint name="kinect_rgb_optical_joint"
           type="fixed" >
           
      <!-- ================================================================ -->
      <parent link="kinect_rgb_frame" />
      <child link="kinect_rgb_optical_frame" />
      <!-- ================================================================ -->
      <origin xyz="0.0 0.0 0.0" 
              rpy="-1.5708 0.0 -1.5708" />
      <!-- ================================================================ -->
                 
    </joint>

    <!-- ################################################################## -->

  </xacro:macro>

<!-- ###################################################################### -->

</robot>
