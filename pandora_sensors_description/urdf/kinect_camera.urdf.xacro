<?xml version="1.0" ?>

<robot xmlns:xacro="http://ros.org/wiki/xacro" >

  <xacro:macro name="kinect_caster"
               params="parent *origin" >

    <link name="kinect_link" >

      <inertial>
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <mass value="0.01" />
        <inertia ixx="0.0004075"
                 ixy="0.0"
                 ixz="0.0"
                 iyy="0.0004075"
                 iyz="0.0"
                 izz="0.0004075" />
      </inertial>

      <collision name="collision" >
        <geometry>
          <box size="0.073000 0.276000 0.072000" />
        </geometry>
      </collision>

      <visual name="visual" >
        <geometry>
          <mesh filename="package://pandora_sensors_description/meshes/kinect_camera/kinect_camera_simple.dae" />
        </geometry>
      </visual>

    </link>

    <link name="kinect_camera" >

      <inertial>
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <mass value="0.001" />
        <inertia ixx="0.00004075"
                 ixy="0.0"
                 ixz="0.0"
                 iyy="0.00004075"
                 iyz="0.0"
                 izz="0.00004075" />
      </inertial>

      <collision name="collision" >
        <geometry>
          <box size="0.001 0.001 0.001" />
        </geometry>
      </collision>

      <visual name="visual" >
        <geometry>
          <box size="0.001 0.001 0.001" />
        </geometry>
      </visual>

    </link> 

    <joint name="kinect_camera_joint"
           type="fixed" >

      <parent link="kinect_link" />
      <child link="kinect_camera" />

      <origin xyz="0 0 0"
              rpy="-1.57 0 -1.57" />

    </joint>

    <gazebo reference="kinect_link" >

      <sensor name="kinect"
              type="depth" >

        <update_rate>20</update_rate>

        <camera>

          <horizontal_fov>1.047198</horizontal_fov>

          <image>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </image>

          <clip>
            <near>0.05</near>
            <far>3</far>
          </clip>

        </camera>

        <plugin name="depth2ros"
                filename="libgazebo_ros_openni_kinect.so" >

          <pointCloudTopicName>point_cloud</pointCloudTopicName>
          <frameName>kinect_camera</frameName>
          <cameraName>kinect</cameraName>
          <imageTopicName>image</imageTopicName>
          <depthImageTopicName>depth/image</depthImageTopicName>
          <depthImageCameraInfoTopicName>depth/image/info</depthImageCameraInfoTopicName>
          <pointCloudCutoff>0.4</pointCloudCutoff>

        </plugin>

      </sensor>

    </gazebo>

    <link name="kinect_base_link" >

      <inertial>
        <mass value="0.001" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.00000001"
                 ixy="0"
                 ixz="0"
                 iyy="0.00000001"
                 iyz="0"
                 izz="0.00000001" />
      </inertial>

      <visual>
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <geometry>
          <box size="0 0 0" />
        </geometry>
      </visual>

      <collision>
        <origin xyz="0 0 0"
                rpy="0 0 0" />
        <geometry>
          <box size="0 0 0" />
        </geometry>
      </collision>

    </link>

    <joint name="kinect_pitch_joint"
           type="revolute" >

      <parent link="${parent}" />
      <child link="kinect_base_link" />

      <xacro:insert_block name="origin" />

      <axis xyz="0 1 0" />
      <limit lower="-1.57"
             upper="1.57"
             effort="300"
             velocity="100.0" />

    </joint>

    <joint name="kinect_yaw_joint"
           type="revolute" >

      <parent link="kinect_base_link" />
      <child link="kinect_link" />

      <origin xyz="0 0 0"
              rpy="0 0 0" />

      <axis xyz="0 0 1" />
      <limit lower="-1.57"
             upper="1.57"
             effort="300"
             velocity="100.0" />

    </joint>

  </xacro:macro>

</robot>
