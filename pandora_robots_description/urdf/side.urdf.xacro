<?xml version="1.0" ?>

<robot xmlns:xacro="http://ros.org/wiki/xacro" >
  
  <xacro:include filename="$(find pandora_robots_description)/urdf/wheel.urdf.xacro" />
  
  <xacro:macro name="side_caster" params="prefix_y reflect_y parent *origin" >
  
    <link name="${prefix_y}_side_link" >
      <inertial>
      <origin xyz="${reflect_y*(-9.2074E-08)} ${reflect_y*(0.010782)} -0.028501"
              rpy="0 0 0" />
        <mass value="0.93539" />
        <inertia ixx="0.001211" ixy="-4.0495E-05" ixz="${reflect_y*(1.0211E-06)}"
               iyy="0.026668" iyz="${reflect_y*(-0.00024586)}" izz="0.026454" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 ${(1-reflect_y)*1.57}" />
        <geometry>
          <mesh filename="package://pandora_robots_description/meshes/gears/side_link.stl" />
        </geometry>
        <material name="" >
          <color rgba="0.753 0.753 0.753 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 ${(1-reflect_y)*1.57}" />
        <geometry>
          <mesh filename="package://pandora_robots_description/meshes/gears/simplified_side_link.stl" />
        </geometry>
      </collision>
    </link>
    
    <joint name="${prefix_y}_side_joint" type="revolute" >
      <xacro:insert_block name="origin" />
      <parent link="${parent}" />
      <child link="${prefix_y}_side_link" />
      <axis xyz="0 1 0" />
      <!-- TODO: Adjust damping -->
      <dynamics damping="0.1" />
      <limit effort="100" velocity="100"
             lower="-0.785" upper="0.785" />
    </joint>
    
    <!--
    
    <gazebo reference="${prefix_y}_side_joint" >
      <implicitSpringDamper>true</implicitSpringDamper>
    </gazebo>
    
    -->
    
    <xacro:wheel_caster prefix_y="${prefix_y}" prefix_x="front"
                        reflect_y="${reflect_y}" reflect_x="1" />
    
    <xacro:wheel_caster prefix_y="${prefix_y}" prefix_x="rear"
                        reflect_y="${reflect_y}" reflect_x="-1" />
    
  </xacro:macro>
  
</robot>
