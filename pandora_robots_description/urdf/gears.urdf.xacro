<?xml version="1.0"?>

<robot xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
       xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
       xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
       xmlns:xacro="http://ros.org/wiki/xacro"
	   name="gears">

<!-- base_link -->
	<link name="base_link_footprint"/>
	
	<joint name="base_footprint_joint" type="fixed">
		<origin xyz="0 0 0.177" rpy="0 0 0"/>
		<parent link="base_link_footprint"/>
		<child link="base_link"/>
	</joint>

	<link name="base_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="0.5" />
		  <inertia ixx="0.0013885" ixy="0" ixz="0"
				   iyy="0.0000225" iyz="0" izz="0.0013885" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.03 0.175 0.03"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.03 0.175 0.03"/>
		  </geometry>
		</collision>
  </link>
  
  <link name="pc_box_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="5" />
		  <inertia ixx="0.07225" ixy="0" ixz="0"
				   iyy="0.2125" iyz="0" izz="0.17225" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.25 0.15 0.08"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.25 0.15 0.08"/>
		  </geometry>
		</collision>
  </link>
  
  <joint name="pc_box_joint" type="fixed">
		<origin xyz="0 0 0.055" rpy="0 0 0"/>
		<parent link="base_link"/>
		<child link="pc_box_link"/>
	</joint>
	
  <link name="elevator_tube_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="0.5" />
		  <inertia ixx="0.0006125" ixy="0" ixz="0"
				   iyy="0.0006125" iyz="0" izz="0.000025" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<cylinder radius="0.01" length="0.12"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<cylinder radius="0.01" length="0.12"/>
		  </geometry>
		</collision>
  </link>
  
   <joint name="elevator_tube_joint" type="fixed">
		<origin xyz="0 0 0.1" rpy="0 0 0"/>
		<parent link="pc_box_link"/>
		<child link="elevator_tube_link"/>
	</joint>
	
	<link name="platform_elevation_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="0.001" />
		  <inertia ixx="0.00000001" ixy="0" ixz="0"
				   iyy="0.00000001" iyz="0" izz="0.00000001" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0 0 0"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0 0 0"/>
		  </geometry>
		</collision>
  </link>
  
	<joint name="platform_elevation_joint" type="fixed">
		<origin xyz="0 0 0.07" rpy="0 0 0"/>
		<parent link="elevator_tube_link"/>
		<child link="platform_elevation_link"/>
	</joint>
	
	<link name="platform_pitch_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="0.001" />
		  <inertia ixx="0.00000001" ixy="0" ixz="0"
				   iyy="0.00000001" iyz="0" izz="0.00000001" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0 0 0"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0 0 0"/>
		  </geometry>
		</collision>
  </link>
  
  
	<joint name="platform_pitch_joint" type="fixed">
		<origin xyz="0 0 0" rpy="0 0 0"/>
		<parent link="platform_elevation_link"/>
		<child link="platform_pitch_link"/>
		<axis xyz="0 1 0"/>
	</joint>
	
	
	<link name="platform_link">
		<inertial>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <mass value="1" />
		  <inertia ixx="0.0052" ixy="0" ixz="0"
				   iyy="0.01" iyz="0" izz="0.0052" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.1 0.1 0.02"/>
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<box size="0.1 0.1 0.02"/>
		  </geometry>
		</collision>
  </link>
  
	<joint name="platform_yaw_joint" type="fixed">
		<origin xyz="0 0 0" rpy="0 0 0"/>
		<parent link="platform_pitch_link"/>
		<child link="platform_link"/>
		<axis xyz="0 0 1"/>
	</joint>

  
<xacro:macro name="wheel_caster" params="suffix_a suffix_b reflect_a reflect_b">
	<link name="${suffix_a}_${suffix_b}_lower_skeleton_link">
		<inertial>
		  <origin xyz="${reflect_b*0.01414} 0 -0.02036" 
			      rpy="0 ${reflect_b*0.785} 0" />
		  <mass  value="0.2" />
		  <inertia
			ixx="0.000003"
			ixy="0"
			ixz="0"
			iyy="0.000009666"
			iyz="0"
			izz="0.000009666" />
		</inertial>
		<visual>
		  <origin xyz="${reflect_b*0.01414} 0 -0.02036" 
			      rpy="0 ${reflect_b*0.785} 0" />
		  <geometry>
			<mesh filename="package://pandora_robots_description/meshes/gears/lower_skeleton.dae" />
		  </geometry>
		  <material name="">
			<color rgba="1 1 0 1" />
		  </material>
		</visual>
		<collision>
		  <origin xyz="${reflect_b*0.01414} 0 -0.02036" 
			      rpy="0 ${reflect_b*0.785} 0" />
		  <geometry>
			<mesh filename="package://pandora_robots_description/meshes/gears/lower_skeleton.dae" />
		  </geometry>
		</collision>
  </link>
  
  <joint name="${suffix_a}_${suffix_b}_lower_skeleton_joint" type="fixed">
    <origin xyz="${reflect_b*0.14} ${reflect_a*0.015} 0" rpy="0 0 0" />
    <parent link="${suffix_a}_upper_skeleton_link" />
    <child link="${suffix_a}_${suffix_b}_lower_skeleton_link" />
    <axis xyz="0 1 0" />
  </joint>
  
  
		<link name="${suffix_a}_${suffix_b}_tire_skeleton_link">
			<inertial>
			  <origin  xyz="0 0 0"
					   rpy="0 0 0" />
			  <mass  value="0.1" />
			  <inertia
				ixx="0.000080875"
				ixy="0"
				ixz="0"
				iyy="0.0000113"
				iyz="0"
				izz="0.0000080875" />
			</inertial>
			<visual>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				<mesh filename="package://pandora_robots_description/meshes/gears/tire_skeleton.dae" />
			  </geometry>
			  <material name="">
				<color rgba="1 1 0 1" />
			  </material>
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				<mesh filename="package://pandora_robots_description/meshes/gears/tire_skeleton.dae" />
			  </geometry>
			</collision>
	  </link>
  
	  <joint name="${suffix_a}_${suffix_b}_tire_skeleton_joint" type="fixed">
		<origin xyz="${reflect_b*0.0345} ${reflect_a*0.022} -0.0345" rpy="0 0 0" />
		<parent link="${suffix_a}_${suffix_b}_lower_skeleton_link" />
		<child link="${suffix_a}_${suffix_b}_tire_skeleton_link" />
		<axis xyz="0 1 0" />
	  </joint>
  
		<link name="${suffix_a}_${suffix_b}_tire_axis_link">
			<inertial>
			  <origin  xyz="0 0 0"
					   rpy="0 0 0" />
			  <mass  value="0.4" />
			  <inertia
				ixx="0.00067563"
				ixy="0"
				ixz="0"
				iyy="0.0005"
				iyz="0"
				izz="0.00067563" />
			</inertial>
			<visual>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				<mesh filename="package://pandora_robots_description/meshes/gears/inner_tire.dae" />
			  </geometry>
			  <material name="">
				<color rgba="1 1 0 1" />
			  </material>
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				<mesh filename="package://pandora_robots_description/meshes/gears/inner_tire.dae" />
			  </geometry>
			</collision>
	  </link>
	  
	  <joint name="${suffix_a}_${suffix_b}_tire_axis_joint" type="fixed">
		<origin xyz="0 ${reflect_a*0.019} 0" rpy="0 1.57 0" />
		<parent link="${suffix_a}_${suffix_b}_tire_skeleton_link" />
		<child link="${suffix_a}_${suffix_b}_tire_axis_link" />
		<axis xyz="0 1 0" />
	  </joint>
  
	<link name="${suffix_a}_${suffix_b}_tire_link">
		<inertial>
		  <origin  xyz="0 0 0"
				   rpy="0 0 0" />
		  <mass  value="0.6" />
		  <inertia ixx="0.0023112" ixy="0" ixz="0"
			       iyy="0.00432" iyz="0" izz="0.0023112" />
		</inertial>
		<visual>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<mesh filename="package://pandora_robots_description/meshes/gears/outer_tire.dae" />
		  </geometry>
		  <material name="">
			<color rgba="1 1 0 1" />
		  </material>
		</visual>
		<collision>
		  <origin xyz="0 0 0" rpy="0 0 0" />
		  <geometry>
			<mesh filename="package://pandora_robots_description/meshes/gears/outer_tire.dae" />
		  </geometry>
		</collision>
  </link>
  
  <joint name="${suffix_a}_${suffix_b}_tire_joint" type="continuous">
    <origin xyz="0 ${reflect_a*0.084} 0" rpy="0 0 0" />
    <parent link="${suffix_a}_${suffix_b}_tire_axis_link" />
    <child link="${suffix_a}_${suffix_b}_tire_link" />
    <axis xyz="0 1 0" />
  </joint>
  
</xacro:macro>

<xacro:macro name="gears_side_caster" params="suffix reflect parent *origin">
	<link name="${suffix}_upper_skeleton_link">
		<inertial>
			<origin xyz="0 ${reflect*0.015} 0" rpy="0 0 0" />
			<mass value="0.4" />
			<inertia ixx="0.000006" ixy="0" ixz="0"
				     iyy="0.002643" iyz="0" izz="0.002643" />
		</inertial>
		<visual>
		  <origin xyz="0 ${reflect*0.015} 0" rpy="0 0 0" />
		  <geometry>
				<mesh filename="package://pandora_robots_description/meshes/gears/upper_skeleton.dae" />
		  </geometry>
		</visual>
		<collision>
		  <origin xyz="0 ${reflect*0.015} 0" rpy="0 0 0" />
		  <geometry>
			     <mesh filename="package://pandora_robots_description/meshes/gears/upper_skeleton.dae" />
		  </geometry>
		</collision>
	  </link>
	  
	<joint name="${suffix}_skeleton_joint" type="revolute">
		<xacro:insert_block name="origin" />
		<parent link="${parent}" />
		<child link="${suffix}_upper_skeleton_link" />
		<axis xyz="0 1 0" />
		<limit effort="30000000" velocity="1000000000000.0" lower="-0" upper="0" />
	  </joint>
	  
	<transmission name="${suffix}_skeleton_transmission">
		<type>transmission_interface/SimpleTransmission</type>
		<joint name="${suffix}_skeleton_joint"/>
		<actuator name="${suffix}_skeleton_motor">
		  <hardwareInterface>EffortJointInterface</hardwareInterface>
		  <mechanicalReduction>1</mechanicalReduction>
		</actuator>
	</transmission>
	  
	<xacro:wheel_caster suffix_a="${suffix}" suffix_b="front" reflect_a="${reflect}" reflect_b="1"/>
	<xacro:wheel_caster suffix_a="${suffix}" suffix_b="rear" reflect_a="${reflect}" reflect_b="-1"/>

</xacro:macro>
  
<xacro:gears_side_caster suffix="left" reflect="1" parent="base_link">
		<origin xyz="0 0.0875 0" rpy="0 0 0" />
</xacro:gears_side_caster>

<xacro:gears_side_caster suffix="right" reflect="-1" parent="base_link">
		<origin xyz="0 -0.0875 0" rpy="0 0 0" />
</xacro:gears_side_caster>


<!-- Add imu plugin-->
	<gazebo>	
		<plugin filename="libgazebo_ros_imu.so" name="imu_en_ros">
			<bodyName>base_link</bodyName>
			<robotNamespace></robotNamespace>
			<topicName>/sensors/imu</topicName>
		</plugin>
	</gazebo>

<!--Insert hokuyo laser-->
	<xacro:include filename="$(find pandora_sensors_description)/urdf/hokuyo_utm_30lx.urdf.xacro" />

	<xacro:hokuyo_caster parent="base_link">
		<origin xyz="0.15 0 0.15" rpy="0 0 0"/>
	</xacro:hokuyo_caster>

<!--Insert kinect-->	
	<xacro:include filename="$(find pandora_sensors_description)/urdf/kinect_camera.urdf.xacro" />
	
	<xacro:kinect_caster parent="platform_link">
		<origin xyz="0.1 0 0.05" rpy="0 0 0"/>
	</xacro:kinect_caster>
  
<!--Insert sonars-->
	<xacro:include filename="$(find pandora_sensors_description)/urdf/sonar_sensor.urdf.xacro" />
  
	<xacro:sonar_caster name="left_rear" parent="base_link">
		<origin xyz="-0.2 0.15 0.13" rpy="0 0 3.14" />
	</xacro:sonar_caster>
	
	<xacro:sonar_caster name="right_rear" parent="base_link">
		<origin xyz="-0.2 -0.15 0.13" rpy="0 0 3.14" />
	</xacro:sonar_caster>

<!--Insert thermal-->	
	<xacro:include filename="$(find pandora_sensors_description)/urdf/pandora_thermal_sensor.urdf.xacro" />
	
	<xacro:thermal_caster parent="base_link">
		<origin xyz="0.2 -0.05 0.23" rpy="0 0 0"/>
	</xacro:thermal_caster>

<!--Insert co2 sensor-->	
	<xacro:include filename="$(find pandora_sensors_description)/urdf/co2_sensor.urdf.xacro" />

	<xacro:co2_caster parent="base_link">
		<origin xyz="0.2 0 0.36" rpy="0 0 0"/>
	</xacro:co2_caster>

<!--Insert microphone-->	
	<xacro:include filename="$(find pandora_sensors_description)/urdf/microphone_sensor.urdf.xacro" />
	
	<xacro:microphone_caster parent="base_link">
		<origin xyz="0.2 0 0.38" rpy="0 0 0"/>
	</xacro:microphone_caster>

<!-- Add ros_control plugin-->
	<gazebo>
	  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
		<robotNamespace></robotNamespace>
		<robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
	  </plugin>
	</gazebo>
	
	<!-- Add skid steer drive plugin-->
	<gazebo>
	  <plugin name="RosSkidSteerDrivePlugin" filename="libgazebo_ros_skid_steer_drive.so">
			<updateRate>50.0</updateRate>
			<robotNamespace></robotNamespace>
			<leftFrontJoint>left_front_tire_joint</leftFrontJoint>
			<rightFrontJoint>right_front_tire_joint</rightFrontJoint>
			<leftRearJoint>left_rear_tire_joint</leftRearJoint>
			<rightRearJoint>right_rear_tire_joint</rightRearJoint>
			<wheelSeparation>0.425</wheelSeparation>
			<wheelDiameter>0.24</wheelDiameter>
			<robotBaseFrame>base_link</robotBaseFrame>
			<topicName>cmd_vel</topicName>
			<broadcastTF>0</broadcastTF>
			<torque>5.0</torque>
			<commandTopic>cmd_vel</commandTopic>
			<odometryTopic>odom</odometryTopic>
			<odometryFrame>odom</odometryFrame>
		</plugin>
	</gazebo>
  
</robot>
